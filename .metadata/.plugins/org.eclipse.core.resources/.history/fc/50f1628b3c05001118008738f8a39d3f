package ProjetMorphologieAlgo;


import java.io.*;
import java.util.Set;

public class TraitementTextuel {
    
    public static void traiterFichier(String nomFichier) {
        // Initialiser structures
        ABRTree arbre = new ABRTree();
        HashTable table = new HashTable();
        
        // 1. Lire le fichier et remplir l'arbre
        try {
            BufferedReader lecteur = new BufferedReader(new FileReader(nomFichier));
            String ligne;
            while ((ligne = lecteur.readLine()) != null) {
                ligne = ligne.trim();
                if (ligne.length() >= 3) { // verbe de 3 lettres minimum
                    arbre.insert(new Racine(ligne));
                    System.out.println("Ajouté à l'arbre: " + ligne);
                }
            }
            lecteur.close();
        } catch (IOException e) {
            System.out.println("Problème avec le fichier: " + e.getMessage());
        }
        
        System.out.println("\n=== Début des transformations ===");
        
        // 2. Parcourir l'arbre
        parcourirNoeuds(arbre.getRoot(), table);
    }
    
    // Parcours récursif de l'arbre
    private static void parcourirNoeuds(ABRNode noeud, HashTable table) {
        if (noeud == null) return;
        
        // Parcours en ordre (gauche, racine, droite)
        parcourirNoeuds(noeud.left, table);
        
        // Traiter le verbe courant
        traiterVerbe(noeud.racine.getLettres(), table);
        
        parcourirNoeuds(noeud.right, table);
    }
    
    // Appliquer tous les schèmes à un verbe
    private static void traiterVerbe(String verbe, HashTable table) {
        System.out.println("\n--- Verbe: " + verbe + " ---");
        
        // Récupérer les schèmes depuis la HashMap
        // Il faut ajouter une méthode dans HashTable pour obtenir les clés
        
        // Version avec Set<String>
        Set<String> schemes = table.getSchemes();
        if (schemes == null || schemes.isEmpty()) {
            System.out.println("Aucun schème disponible dans la table!");
            return;
        }
        
        for (String scheme : schemes) {
            try {
                String transformation = table.transformer(verbe, scheme);
                System.out.println(scheme + ": " + transformation);
            } catch (Exception e) {
                System.out.println(scheme + ": transformation impossible");
            }
        }
    }
    
    // Point d'entrée
    public static void main(String[] args) {
        traiterFichier("/ProjetMorphologie/src/ProjetMorphologieAlgo/verbes.txt");
    }
}